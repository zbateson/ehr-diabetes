<div ng-controller="InitialVisitController as visit">
    <div class="form-content">
        <div layout-gt-xs="row">
            <md-input-container class="md-block" flex-gt-xs>
                <label>Gender</label>
                <md-select doctore-select-editable ng-model="visit.gender">
                    <md-option value="M">Male</md-option>
                    <md-option value="F">Female</md-option>
                    <doctore-option-editable>Other...</doctore-option-editable>
                </md-select>
            </md-input-container>
            <div hide-gt-xs style="height:30px"></div>
            <md-input-container>
                <label>Birthdate</label>
                <md-datepicker ng-model="visit.birthDate" md-current-view="year" md-open-on-focus md-max-date="visit.maxDate"></md-datepicker>
            </md-input-container>
            <md-input-container>
                <label>T2DM Since</label>
                <md-datepicker ng-model="visit.t2dmDate" md-current-view="year" md-open-on-focus md-max-date="visit.maxDate"></md-datepicker>
            </md-input-container>
        </div>

        <md-input-container class="md-block">
            <label>Case Points</label>
            <textarea ng-model="visit.keyPoints" rows="4" md-select-on-focus></textarea>
            <span class="hint">Personal, social or financial issues which affect diabetes management directly or indirectly...</span>
        </md-input-container>

        <div layout-gt-xs="row">
            <md-input-container class="md-block" flex>
                <label>Microvascular Complications</label>
                <md-select doctore-select-editable ng-model="visit.microComplications" placeholder="No Microvascular Complications" multiple>
                    <doctore-option-editable>Something else...</doctore-option-editable>
                    <md-option value="Diabetic Retinopathy">Diabetic Retinopathy</md-option>
                    <md-option value="Diabetic Nephropathy">Diabetic Nephropathy</md-option>
                    <md-option value="Diabetic Peripheral Neuropathy">Diabetic Peripheral Neuropathy</md-option>
                    <md-option value="Diabetic Autonomic Neuropathy">Diabetic Autonomic Neuropathy</md-option>
                </md-select>
            </md-input-container>
            <md-input-container class="md-block" flex>
                <label>Macrovascular Complications</label>
                <md-select ng-model="visit.macroComplications" placeholder="No Macrovascular Complications" multiple>
                    <md-option value="Coronary Artery Disease">Coronary Artery Disease</md-option>
                    <md-option value="Stroke">Stroke</md-option>
                </md-select>
            </md-input-container>
        </div>

        <input type="date" name="blah" />
        <div layout-gt-xs="row">
            <!-- min was 1, max was 30, step was 0.1 -->

            <doctore-input-trend ng-model="visit.hba1c" number-label="HbA1C (%)">
            </doctore-input-trend>

            <md-input-container class="md-block" flex-gt-xs>
                <label>FBS (mmol/L)</label>
                <input type="number" step="0.1" name="fbs" ng-model="visit.fbs" min="100" />
            </md-input-container>
            <md-input-container class="md-block" flex-gt-xs>
                <label>LDL (mmol/L)</label>
                <input type="number" step="0.1" name="ldl" ng-model="visit.ldl" min="0.1" max="20" />
            </md-input-container>
        </div>
        <div layout-gt-xs="row">
            <md-input-container class="md-block" flex-gt-xs>
                <label>BP</label>
                <input type="text" name="bp" ng-model="visit.bp" />
            </md-input-container>
            <md-input-container class="md-block" flex-gt-xs>
                <label>SMBG Pre-meal</label>
                <input type="number" step="0.1" name="premeal" ng-model="visit.premeal" min="3.9" />
            </md-input-container>
            <md-input-container class="md-block" flex-gt-xs>
                <label>Post-meal</label>
                <input type="number" step="0.1" name="postmeal" ng-model="visit.postmeal" min="3.9" />
            </md-input-container>
        </div>
        <div layout-gt-xs="row">
            <md-input-container class="md-block" flex-gt-xs>
                <label>eGFR</label>
                <input type="number" step="0.1" name="egfr" ng-model="visit.egfr" min="1" max="100" />
            </md-input-container>
            <md-input-container class="md-block" flex-gt-xs>
                <label>Urine for ACR</label>
                <input type="number" step="0.1" name="acr" ng-model="visit.acr" min="1" max="500" />
            </md-input-container>
            <md-input-container class="md-block" flex-gt-xs>
                <md-select ng-model="visit.acrLevel">
                    <md-option value="Normal">Normal</md-option>
                    <md-option value="High First Time">High First Time</md-option>
                    <md-option value="High Second Time">High Second Time</md-option>
                </md-select>
            </md-input-container>
        </div>
        <div layout-gt-xs="row">
            <md-input-container class="md-block" flex-gt-xs>
                <label>Vitamin B12</label>
                <input type="number" step="1" name="egfr" ng-model="visit.b12" min="1" max="2000" />
            </md-input-container>
        </div>

        <md-chips ng-model="visit.medications.diabetes" placeholder="Add diabetes medications...">
            <md-chip-template>
                <span class="chip-name">{{$chip}}</span>
            </md-chip-template>
            <button md-chip-remove class="md-primary chip-button">
                <md-icon>&#xE5C9;</md-icon>
            </button>
        </md-chips>

        <md-chips ng-model="visit.medications.dyslipidemia" placeholder="Add dyslipidemia medications...">
            <md-chip-template>
                <span class="chip-name">{{$chip}}</span>
            </md-chip-template>
            <button md-chip-remove class="md-primary chip-button">
                <md-icon>&#xE5C9;</md-icon>
            </button>
        </md-chips>

        </md-input-container>
        <md-input-container class="md-block">
            <label>Hyertension Medications</label>
            <div ng-cloak>
                <md-chips ng-model="visit.medications.hypertension">
                    <md-chip-template>
                        <span class="chip-name">{{$chip}}</span>
                    </md-chip-template>
                    <button md-chip-remove class="md-primary chip-button">
                        <md-icon>&#xE5C9;</md-icon>
                    </button>
                </md-chips>
            </div>
        </md-input-container>
        <md-input-container class="md-block">
            <label>Other Medications</label>
            <div ng-cloak>
                <md-chips ng-model="visit.medications.other" placeholder="Type here to add a medication">
                    <md-chip-template>
                        <span class="chip-name">{{$chip}}</span>
                    </md-chip-template>
                    <button md-chip-remove class="md-primary chip-button">
                        <md-icon>&#xE5C9;</md-icon>
                    </button>
                </md-chips>
            </div>
        </md-input-container>
        <div layout-gt-xs="row">
            <md-input-container class="md-block" flex-gt-xs>
                <label>Weight (kg)</label>
                <input type="number" step="1" name="weight" ng-model="visit.weight" />
            </md-input-container>
            <md-input-container class="md-block" flex-gt-xs>
                <label>Height (cm)</label>
                <input type="number" step="1" name="qs" ng-model="visit.height" />
            </md-input-container>
            <md-input-container class="md-block" flex-gt-xs>
                <label>BMI (calculated)</label>
                <input type="number" step="1" value="{{ (visit.weight / (2*(visit.height/100))) }}" readonly />
            </md-input-container>
        </div>

        <md-input-container class="md-block">
            <label>Presenting History</label>
            <textarea ng-model="visit.history" rows="4" md-select-on-focus></textarea>
        </md-input-container>
        <md-input-container class="md-block">
            <label>Past Medical History</label>
            <textarea ng-model="visit.pastHistory" rows="4" md-select-on-focus></textarea>
        </md-input-container>
        <fieldset>
            <legend>Hypoglycemia</legend>
            <div layout-gt-xs="row">
                <md-input-container style="width:80px">
                    <label>Frequency</label>
                    <input type="text" ng-model="visit.hypos" />
                </md-input-container>
                <md-input-container style="min-width:80px">
                    <label>per...</label>
                    <md-select ng-model="visit.hyposPer">
                        <md-option value="Day">Day</md-option>
                        <md-option value="Week" selected>Week</md-option>
                        <md-option value="Month">Month</md-option>
                    </md-select>
                </md-input-container>
                <md-input-container flex>
                    <label>with severity...</label>
                    <md-select ng-model="visit.hyposSeverity">
                        <md-option value="Mild" selected>Mild</md-option>
                        <md-option value="Severe">Severe</md-option>
                    </md-select>
                </md-input-container>
            </div>
        </fieldset>

        <div layout-gt-xs="row">
            <md-input-container class="md-block" flex-gt-xs>
                <label>Exercise</label>
                <input type="text" ng-model="visit.exercise" />
            </md-input-container>
            <md-input-container class="md-block" flex-gt-xs>
                <label>Diet</label>
                <input type="text" ng-model="visit.diet" />
            </md-input-container>
        </div>
        <div layout-gt-xs="row">
            <md-input-container class="md-block" flex-gt-xs>
                <label>Smoking</label>
                <md-select ng-model="visit.smoking">
                    <md-option value="Lifelong non-smoker" selected>Lifelong non-smoker</md-option>
                    <md-option value="Ex-smoker">Ex-smoker</md-option>
                    <md-option value="Current Smoker">Current Smoker</md-option>
                    <md-option value="Negative Smoker">Negative Smoker</md-option>
                </md-select>
            </md-input-container>
            <md-input-container class="md-block" flex-gt-xs>
                <input type="text" placeholder="Details..." ng-model="visit.smokingDetails" />
                <span class="hint">e.g. 30 pack-year</span>
            </md-input-container>
            <md-input-container class="md-block" flex-gt-xs>
                <label>Alcohol</label>
                <md-select ng-model="visit.alcohol">
                    <md-option value="None" selected>None</md-option>
                    <md-option value="Light">Light drinker</md-option>
                    <md-option value="Medium">Medium drinker</md-option>
                    <md-option value="Heavy">Heavy drinker</md-option>
                </md-select>
            </md-input-container>
            <md-input-container class="md-block" flex-gt-xs>
                <input type="text" placeholder="Details..." ng-model="visit.alcoholDetails" />
            </md-input-container>
        </div>
        <div layout-gt-xs="row">
            <!--md-input-container class="md-block">
                <label>Up-to-date vaccinations</label>
                <div ng-cloak-->
                    <md-chips class="md-block" flex ng-model="visit.vaccinations" placeholder="Add up-to-date vaccination">
                        <md-chip-template>
                            <span class="chip-name">{{$chip}}</span>
                        </md-chip-template>
                        <button md-chip-remove class="md-primary chip-button">
                            <md-icon>&#xE5C9;</md-icon>
                        </button>
                    </md-chips>
                <!--/div>
            </md-input-container-->
            <md-input-container style="min-width: 200px">
                <label>Injection Site Rotation</label>
                <md-select ng-model="visit.injectionSiteRotation" >
                    <md-option value="Good" selected>Good</md-option>
                    <md-option value="No Rotation">No Rotation</md-option>
                </md-select>
            </md-input-container>
            <md-input-container>
                <label>Rotation notes...</label>
                <input type="text" ng-model="visit.injectinoSiteNots" />
            </md-input>
        </div>

        <md-input-container class="md-block" flex>
            <label>Ophthalmology</label>
            <input type="text" ng-model="visit.opthalmology" placeholder="On Regular Follow-up" />
            <span class="hint">Leave blank if on regular follow-up, fill in otherwise</span>
        </md-input-container>

        <md-input-container class="md-block">
            <label>Feet</label>
            <md-select doctore-select-editable ng-model="visit.feet">
                <md-option value="Intact protective sensation">Intact protective sensation</md-option>
                <md-option value="Loss of protective sensation">Loss of protective sensation</md-option>
                <doctore-option-editable>Other or more detailed...</doctore-option-editable>
            </md-select>
        </md-input-container>

        <md-input-container class="md-block">
            <label>Family History</label>
            <textarea ng-model="visit.familyHistory" rows="4" md-select-on-focus></textarea>
        </md-input-container>

        <md-input-container class="md-block">
            <label>Social History</label>
            <textarea ng-model="visit.socialHistory" rows="4" md-select-on-focus></textarea>
        </md-input-container>

        <md-input-container class="md-block">
            <label>Allergies (leave blank for none)</label>
            <div ng-cloak>
                <md-chips ng-model="visit.allergies" placeholder="Click to add an allergy">
                    <md-chip-template>
                        <span class="chip-name">{{$chip}}</span>
                    </md-chip-template>
                    <button md-chip-remove class="md-primary chip-button">
                        <md-icon>&#xE5C9;</md-icon>
                    </button>
                </md-chips>
            </div>
        </md-input-container>

        <md-input-container class="md-block">
            <label>Physical Examination</label>
            <textarea ng-model="visit.physical" rows="4" placeholder="The Patient appeared well and was in no distress." md-select-on-focus></textarea>
        </md-input-container>

        <div layout-gt-xs="row">
            <md-input-container class="md-block" flex-gt-xs>
                <label>BP</label>
                <input type="text" name="bp" ng-model="visit.bp" />
            </md-input-container>
            <md-input-container class="md-block" flex-gt-xs>
                <label>Pulse Rate</label>
                <input type="number" name="pulse" ng-model="visit.pulseRate" min="20" max="300" />
            </md-input-container>
            <md-input-container class="md-block" flex-gt-xs>
                <md-select ng-model="visit.pulseRegularity">
                    <md-option value="Regular" selected>Regular</md-option>
                    <md-option value="Irregular">Irregular</md-option>
                    <!-- type an option -->
                </md-select>
            </md-input-container>
            <md-input-container class="md-block" flex-gt-xs>
                <label>Weight (kg)</label>
                <input type="number" step="1" name="weight" ng-model="visit.weight" />
            </md-input-container>
            <md-input-container class="md-block" flex-gt-xs>
                <label>Height (cm)</label>
                <input type="number" step="1" name="qs" ng-model="visit.height" />
            </md-input-container>
            <md-input-container class="md-block" flex-gt-xs>
                <label>BMI (calculated)</label>
                <input type="number" step="1" name="qs" ng-model="visit.bmi" readonly />
            </md-input-container>
        </div>

        <div><input type="checkbox" id="gland" checked="checked" /><label for="gland">&nbsp;Thyroid gland was normal in size and texture</label></div>
        <div><input type="checkbox" id="chest" checked="checked" /><label for="chest">&nbsp;Chest was clear on auscultation</label></div>
        <div><input type="checkbox" id="heart" checked="checked" /><label for="heart">&nbsp;Heart sounds were dual and physiological with no extra heart sounds or murmurs</label></div>
        <div><input type="checkbox" id="abdomen" checked="checked" /><label for="abdomen">&nbsp;Abdomen was benign with no organomegaly</label></div>
        <div><input type="checkbox" id="neurology" checked="checked" /><label for="neurology">&nbsp;There were no focal neurological findings</label></div>


        <md-input-container class="md-block">
            <label>Impression</label>
            <textarea ng-model="impression" rows="4" md-select-on-focus></textarea>
        </md-input-container>

        <md-input-container class="md-block">
            <label>Recommendation</label>
            <textarea ng-model="recommendation" rows="4" md-select-on-focus></textarea>
        </md-input-container>
    </div>
    <div class="print-preview">
        <div class="print-preview-content">
            <table>
                <tr>
                    <th colspan="4">
                        doctore.me<span>Endocrinology initial visit</span>
                    </th>
                </tr>
                <tr>
                    <td><span class="label">Gender</span>&nbsp;{{ visit.gender }}</td>
                    <td><span class="label">Birthdate</span>&nbsp;{{ visit.birthDate | date:'yyyy-MM-dd' }}</td>
                    <td><span class="label">Age</span>&nbsp;{{ visit.birthDate | age }}</td>
                    <td class="rowspanning" rowspan="9">
                        <table>
                            <tr><td><span class="label">T2DM Since</span>&nbsp;{{ visit.t2dmDate | date:'yyyy-MM-dd' }}</td></tr>
                            <tr><td><span class="label">HbA1C</span>&nbsp;{{ visit.hba1c.join(', ') }}</td></tr>
                            <tr><td><span class="label">FBS</span>&nbsp;{{ visit.fbs }}</td></tr>
                            <tr><td><span class="label">SMBG pre-meal</span>&nbsp;{{ visit.premeal }}</td></tr>
                            <tr><td><span class="label">SMBG post-meal</span>&nbsp;{{ visit.postmeal }}</td></tr>
                            <tr><td><span class="label">LDL</span>&nbsp;{{ visit.ldl }}</td></tr>
                            <tr><td><span class="label">Urine for ACR</span>&nbsp;{{ visit.acr }} ({{ visit.acrLevel }})</td></tr>
                            <tr><td><span class="label">Vitamin B12</span>&nbsp;{{ visit.b12 }}</td></tr>
                            <tr><td><span class="label">eGFR</span>&nbsp;{{ visit.egfr }}</td></tr>
                            <tr><td><span class="label">BP</span>&nbsp;{{ visit.bp }}</td></tr>
                            <tr><td><span class="label">Weight</span>&nbsp;{{ visit.weight }}kg</td></tr>
                            <tr><td><span class="label">Height</span>&nbsp;{{ visit.height }}cm</td></tr>
                            <tr><td><span class="label">BMI</span>&nbsp;{{ visit.bmi }}</td></tr>
                        </table>
                    </td>
                </tr>
                <tr>
                    <td colspan="3">
                        <span class="label">Case Points</span>
                        <span class="pre-area">{{ visit.keyPoints }}</span>
                    </td>
                </tr>
                <tr>
                    <td colspan="3">
                        <span class="label">Micro Complications</span>
                        <span class="pre-area">{{ visit.microComplications.join("\n") }}</span>
                    </td>
                </tr>
                <tr>
                    <td colspan="3">
                        <span class="label">Macro Complications</span>
                        <span class="pre-area">{{ visit.macroComplications.join('\n') }}</span>
                    </td>
                </tr>
                <tr>
                    <td colspan="3">
                        <span class="label">Diabetes Medications</span>
                        <span class="pre-area">{{ visit.medications.diabetes.join('\n') }}</span>
                    </td>
                </tr>
                <tr>
                    <td colspan="3">
                        <span class="label">Dyslipidemia Medications</span>
                        <span class="pre-area">{{ visit.medications.dyslipidemia.join('\n') }}</span>
                    </td>
                </tr>
                <tr>
                    <td colspan="3">
                        <span class="label">Hypertension Medications</span>
                        <span class="pre-area">{{ visit.medications.hypertension.join('\n') }}</span>
                    </td>
                </tr>
                <tr>
                    <td colspan="3">
                        <span class="label">Other Medications</span>
                        <span class="pre-area">{{ visit.medications.other.join('\n') }}</span>
                    </td>
                </tr>
                <tr>
                    <td colspan="3">
                        <span class="label">Hypoglycemia</span>
                        <span class="field-line">{{ visit.hypos }}</span>
                    </td>
                </tr>
                <tr>
                    <td colspan="4">
                        <span class="label">Presenting History</span>
                        <span class="pre-area">{{ visit.history }}</span>
                    </td>
                </tr>
                <tr>
                    <td colspan="4">
                        <span class="label">Past Medical History</span>
                        <span class="pre-area">{{ visit.pastHistory }}</span>
                    </td>
                </tr>
                <tr>
                    <td colspan="4"><span class="label">Exercise</span>&nbsp;{{ visit.exercise }}</td>
                </tr>
                <tr>
                    <td colspan="4"><span class="label">Diet</span>&nbsp;{{ visit.diet }}</td>
                </tr>
                <tr>
                    <td colspan="4"><span class="label">Smoking</span>&nbsp;{{ visit.smoking }}</td>
                </tr>
                <tr>
                    <td colspan="4"><span class="label">Alcohol</span>&nbsp;{{ visit.alcohol }}</td>
                </tr>
                <tr>
                    <td colspan="4">
                        <span class="label">Vaccinations</span>
                        <span class="pre-area">{{ visit.vaccinations.join(', ') }}</span>
                    </td>
                </tr>
                <tr>
                    <td colspan="4"><span class="label">Injection Sites</span>&nbsp;{{ visit.injectionSites.join(', ') }}</td>
                </tr>
                <tr>
                    <td colspan="4"><span class="label">Ophthalmology</span>&nbsp;{{ visit.ophthalmology }}</td>
                </tr>
                <tr>
                    <td colspan="4"><span class="label">Allergies</span>&nbsp;{{ visit.allergies.length === 0 ? 'No known allergies for food or drugs' : visit.allergies.join(', ') }}</td>
                </tr>
                <tr>
                    <td colspan="4"><span class="label">Feet</span>&nbsp;{{ visit.feet }}</td>
                </tr>
                <tr>
                    <td colspan="4">
                        <span class="label">Impression</span>
                        <span class="pre-area">{{ visit.impression }}</span>
                    </td>
                </tr>
                <tr>
                    <td colspan="4">
                        <span class="label">Recommendations and Follow Up</span>
                        <span class="pre-area">{{ visit.recommendations }}</span>
                    </td>
                </tr>
            </table>
        </div>
    </div>
</div>
